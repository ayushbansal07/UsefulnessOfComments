<!DOCTYPE html>
<html>
  <head>
    <title>libpng_pngmem</title>
    <link href="./styles/prism.css" rel="stylesheet" />
    <link href="./styles/form.css" rel="stylesheet" />
  </head>
    <style>
	.btnc {

	    background-color: #1e7ef4;
	    border: none;
	    color: white;
	    padding: 8px 12px;
	    text-align: center;
	    font-size: 12px;
	    font-weight: bold;
	    margin: 4px 2px;
	    opacity: 0.6;
	    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);

	    transition: 0.4s;
	  }

	  .btnc:hover {opacity: 1}
	  </style>
  <body>

  	<div class="form-popup" id="myForm">
	  <form action="/action_page.php" class="form-container" onsubmit="return postToGoogle();">

      <label for="emailField"><b>Email id</b></label>
      <input type="email" id="emailField" name="emailField" required><br>

	    <label for="commentUsefulness"><b>This comment is </b></label>
	    <input id="commentUseful" type="radio" name="commentUsefulness" value="U" required> Useful
		<input id="commentNotUseful" type="radio" name="commentUsefulness" value="NU" required> Useless
    <input id="commentPartialUseful" type="radio" name="commentUsefulness" value="PU" required> Partially Useful<br>

	    <label for="commentView"></label>
	    <input id="commentView" type="text" placeholder="Why do you think so?" name="commentView" required>

	    <label for="commentAlternate"></label>
	    <textarea id="commentAlternate" type="text" placeholder="If you would have written a comment for that portion of the code, what would you have written? (optional)" name="commentAlternate" style="height:100px;"></textarea> 

	    <button type="submit" class="btn">Submit</button>
	    <button id="closeFormButton" type="reset" class="btn cancel" onclick="closeForm()">Close</button>
	  </form>
	</div>


  	<script src="./javascript/prism.js"></script>
  	<pre>
  		<table>
  			<!--start-->
<div hidden id="commentCodeID">libpng_pngmem</div><tr>
<td><pre><code class="language-c">/* pngmem.c - stub functions for memory allocation of libpng -- raster-graphics file-format </code></pre></td>
<td><button class="btnc" type="button" id="comment1" onclick="openForm(this.id)">Comment 1</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* Copyright (c) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * This code is released under the libpng license. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * For conditions of distribution and use, see the disclaimer </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * and license in png.h </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> */  </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> /* This file provides a location for all memory allocation.  Users who </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * need special memory handling are expected to supply replacement </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * functions for png_malloc() and png_free(), and to use </code></pre></td>
<td><button class="btnc" type="button" id="comment2" onclick="openForm(this.id)">Comment 2</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> * png_create_read_struct_2() and png_create_write_struct_2() to </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * identify the replacement functions. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#include "pngpriv.h" </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#include "pngstruct.h" </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#if defined(PNG_READ_SUPPORTED) || defined(PNG_WRITE_SUPPORTED) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* Free a png_struct */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* png_destroy_png_struct calls png_free  </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">which  might call png_error and may certainly call </code></pre></td>
<td><button class="btnc" type="button" id="comment3" onclick="openForm(this.id)">Comment 3</button></td>
</tr>
<tr>
<td><pre><code class="language-c">       * png_get_mem_ptr, so fake a temporary png_struct to support this. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">       */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">void  png_destroy_png_struct(png_structrp png_ptr) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">{ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (png_ptr != NULL) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   { </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">       </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      png_struct dummy_struct = *png_ptr; </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      memset(png_ptr, 0, (sizeof *png_ptr)); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      png_free(&dummy_struct, png_ptr); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#     ifdef PNG_SETJMP_SUPPORTED </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">         /* We may have a jmp_buf left to deallocate. */ </code></pre></td>
<td><button class="btnc" type="button" id="comment4" onclick="openForm(this.id)">Comment 4</button></td>
</tr>
<tr>
<td><pre><code class="language-c">         png_free_jmpbuf(&dummy_struct); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#     endif </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   } </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">} </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* Allocate memory.  For reasonable files, size should never exceed </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * 64K.  However, zlib may allocate more than 64K if you don't tell </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * it not to.  See zconf.h and png.h for more information.  zlib does </code></pre></td>
<td><button class="btnc" type="button" id="comment5" onclick="openForm(this.id)">Comment 5</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> * need to allocate exactly 64K, so whatever you call here must </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * have the ability to do that. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* uses png_calloc defined in pngriv.h*/ </code></pre></td>
<td><button class="btnc" type="button" id="comment6" onclick="openForm(this.id)">Comment 6</button></td>
</tr>
<tr>
<td><pre><code class="language-c">PNG_FUNCTION(png_voidp,PNGAPI </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">png_calloc,(png_const_structrp png_ptr, png_alloc_size_t size),PNG_ALLOCATED) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">{ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   png_voidp ret; </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   ret = png_malloc(png_ptr, size); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (ret != NULL) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      memset(ret, 0, size); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   return ret; </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">} </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#ifndef PNG_USER_MEM_SUPPORTED </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   PNG_UNUSED(png_ptr) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#endif </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#if defined(PNG_TEXT_SUPPORTED) || defined(PNG_sPLT_SUPPORTED) ||\ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   defined(PNG_STORE_UNKNOWN_CHUNKS_SUPPORTED) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* Introduced in libpng 1.6.0, commit 0e13545. This is really here only to work round a spurious warning in GCC 4.6 and 4.7 </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> * that arises because of the checks in png_realloc_array that are repeated in </code></pre></td>
<td><button class="btnc" type="button" id="comment7" onclick="openForm(this.id)">Comment 7</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> * png_malloc_array, issue #289. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">static png_voidp </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">png_malloc_array_checked(png_const_structrp png_ptr, int nelements, </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">    size_t element_size) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">{ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   png_alloc_size_t req = (png_alloc_size_t)nelements; /* known to be > 0 */ </code></pre></td>
<td><button class="btnc" type="button" id="comment8" onclick="openForm(this.id)">Comment 8</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (req &lt;= PNG_SIZE_MAX/element_size) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      return png_malloc_base(png_ptr, req * element_size); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   return NULL; </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">} </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   /* Check for overflow on the elements count (so the caller does not have to </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">    * check.) png_malloc_array has been worked with the size calculations to avoid </code></pre></td>
<td><button class="btnc" type="button" id="comment9" onclick="openForm(this.id)">Comment 9</button></td>
</tr>
<tr>
<td><pre><code class="language-c">          * overflow. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">    */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">PNG_FUNCTION(png_voidp, </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">png_realloc_array,(png_const_structrp png_ptr, png_const_voidp old_array, </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">    int old_elements, int add_elements, size_t element_size),PNG_ALLOCATED) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">{ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   /* These are internal errors: */ </code></pre></td>
<td><button class="btnc" type="button" id="comment10" onclick="openForm(this.id)">Comment 10</button></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (add_elements &lt;= 0 || element_size == 0 || old_elements &lt; 0 || </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      (old_array == NULL && old_elements > 0)) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      png_error(png_ptr, "internal error: array realloc"); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (add_elements &lt;= INT_MAX - old_elements) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   { </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      png_voidp new_array = png_malloc_array_checked(png_ptr, </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">          old_elements+add_elements, element_size); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      if (new_array != NULL) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      { </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">          </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">         if (old_elements > 0) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">            memcpy(new_array, old_array, element_size*(unsigned)old_elements); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">         memset((char*)new_array + element_size*(unsigned)old_elements, 0, </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">             element_size*(unsigned)add_elements); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">         return new_array; </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      } </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   } </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   return NULL; /* error */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">} </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#endif /* TEXT || sPLT || STORE_UNKNOWN_CHUNKS */ </code></pre></td>
<td><button class="btnc" type="button" id="comment11" onclick="openForm(this.id)">Comment 11</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">/* Free a pointer allocated by png_malloc().  If ptr is NULL, return </code></pre></td>
<td><button class="btnc" type="button" id="comment12" onclick="openForm(this.id)">Comment 12 (LAST)</button></td>
</tr>
<tr>
<td><pre><code class="language-c"> * without taking any action. </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">void PNGAPI </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">png_free(png_const_structrp png_ptr, png_voidp ptr) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">{ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (png_ptr == NULL || ptr == NULL) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      return; </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#ifdef PNG_USER_MEM_SUPPORTED </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   if (png_ptr->free_fn != NULL) </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      png_ptr->free_fn(png_constcast(png_structrp,png_ptr), ptr); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">   else </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">      png_free_default(png_ptr, ptr); </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">} </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c"> </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#endif /* USER_MEM */ </code></pre></td>
</tr>
<tr>
<td><pre><code class="language-c">#endif /* READ || WRITE */ </code></pre></td>
</tr>
  <!-- end -->
  		</table>
  		
  		<code class="language-c">
  		</code>
  	</pre>
  </body>
</html>
<script async src="./javascript/index.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>